# 一、环境准备与框架搭建

## 环境准备

由于前端所给的代码为静态HTML文件，因此首先需要准备相应的环境（这里需要的是python3、pip、Flask），并初步搭建起项目的结构。

在这里，首先就遭遇了环境配置失败的问题，无法用pip直接在系统python环境下安装包，在采取了另外一种方法——	使用apt安装Flask等常见包，也遭遇了失败。因此，我不得不采用另外一种方法——创建虚拟环境进行安装。以下是大致操作

### 用 venv 创建虚拟环境（推荐用于开发/自定义包）

1. **创建虚拟环境**（在你的项目目录~/idv_site下）：

   ```bash
   python3 -m venv myvenv
   ```

2. **激活虚拟环境**：

   ```bash
   source myvenv/bin/activate
   ```

3. **在虚拟环境中用 pip 安装依赖**：

   ```bash
   pip install flask flask_sqlalchemy werkzeug
   ```

   > 激活后，命令行前面会出现 `(venv)`，此时 pip 安装的包只影响当前项目，不会破坏系统环境。

4. **运行你的 Flask 项目**（激活环境后直接运行）：

   ```bash
   python app.py
   ```



## 框架搭建

#### 创建项目目录与结构

```bash
mkdir ~/idv_site
cd ~/idv_site
mkdir templates
touch app.py
```

![image-20250511141649338](C:\Users\文木杉\AppData\Roaming\Typora\typora-user-images\image-20250511141649338.png)

# ![image-20250427124626505](C:\Users\文木杉\AppData\Roaming\Typora\typora-user-images\image-20250427124626505.png)

idv_site/ 

├── app.py 

├── characters.html 

├── index.html 

├── login.html 

├── register.html 

├── instance/ ——idv.db

├── myenv/ ——bin  include  lib  lib64  pyvenv.cfg

└── templates/——content.html  login.html  register.html

---

### 1. `ls instance`
输出：  
```
idv.db
```
**解释：**  
`instance` 是你项目里的一个文件夹，里面有一个名为 `idv.db` 的文件。  
通常 `.db` 文件是数据库文件（比如 SQLite 数据库），用来存储你网站的数据。

---

### 2. `ls myenv`
输出：  
```
bin  include  lib  lib64  pyvenv.cfg
```
**解释：**  
`myenv` 是一个 Python 虚拟环境的文件夹。  
- `bin`、`include`、`lib`、`lib64` 这些都是虚拟环境的标准目录，用来隔离和管理你项目用到的 Python 包和解释器。
- `pyvenv.cfg` 是虚拟环境的配置文件。

---

### 3. `ls templates`
输出：  
```
content.html  login.html  register.html
```
**解释：**  
`templates` 文件夹里有三个 HTML 文件：`content.html`、`login.html`、`register.html`。  
这通常是 Flask、Django 等 Python Web 框架的模板目录，用来存放网页模板文件。

---

### 总结

- 你的项目目录下有一个数据库文件（`instance/idv.db`），用来存储数据。
- 有一个 Python 虚拟环境（`myenv`），用来隔离项目依赖。
- 有一个模板文件夹（`templates`），里面放着网站的网页模板。

这些都是一个典型 Python Web 项目的结构。  



# 二、数据库创建以及代码块：

## app.py

```python
from flask import Flask, render_template, request, jsonify, session, redirect, url_for
from flask_sqlalchemy import SQLAlchemy
from werkzeug.security import generate_password_hash, check_password_hash

app = Flask(__name__)
app.secret_key = 'super-idv-secret-key'
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///idv.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
db = SQLAlchemy(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
        password_hash = db.Column(db.String(200), nullable=False)
    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)

@app.route('/')
def index():
    if 'user_id' in session:
        return redirect('/content')
    return redirect('/login')

@app.route('/login', methods=['GET'])
def login_page():
    return render_template('login.html')

@app.route('/login', methods=['POST'])
def login_api():
    username = request.form.get('username')
    password = request.form.get('password')
    user = User.query.filter_by(username=username).first()
    if user and user.check_password(password):
        session['user_id'] = user.id
        return jsonify(success=True)
    return jsonify(success=False, message='账号或密码错误')

@app.route('/register', methods=['GET'])
def register_page():
    return render_template('register.html')

@app.route('/register', methods=['POST'])
def register_api():
  # 前端post用application/json
    if request.is_json:
        data = request.get_json()
        username = data.get('username', '').strip()
        password = data.get('password', '')
    else:
           username = request.form.get('username', '').strip()
        password = request.form.get('password', '')
    if len(username) < 4 or len(password) < 6:
        return jsonify(error='用户名/密码太短')
    if User.query.filter_by(username=username).first():
        return jsonify(error='用户名已被注册')
    user = User(username=username)
    user.set_password(password)
    db.session.add(user)
    db.session.commit()
    return jsonify(message='注册成功')

@app.route('/content')
def content():
    if 'user_id' not in session:
        return redirect('/login')
    # 简易角色数据，可以自行扩充
    roles = {
        "jgz": [
            {"name": "杰克", "img": "https://id5.res.netease.com/pc/gw/20220408094220/img/role/jack.png", "desc": "监管者，绅士杀手，拥有雾刃技能。"},
            {"name": "厂长", "img": "https://id5.res.netease.com/pc/gw/20220408094220/img/role/bane.png", "desc": "监管者，能召唤傀儡，控制全场。"}
        ],
        "qsz": [
            {"name": "医生", "img": "https://id5.res.netease.com/pc/gw/20220408094220/img/role/doctor.png", "desc": "求生者，擅长治疗自己和队友。"},
            {"name": "律师", "img": "https://id5.res.netease.com/pc/gw/20220408094220/img/role/lawyer.png", "desc": "求生者，能查看地图，辅助全队。"}
        ]
    }
    return render_template('content.html', roles=roles)

@app.route('/logout')
def logout():
    session.pop('user_id', None)
    return redirect('/login')
if __name__ == '__main__':
    with app.app_context():
        db.create_all()
    app.run(host="0.0.0.0", port=5000, debug=True)
```

值得注意的的是，在最后若干行中，应该写成`if __name__ == "__main__":    with app.app_context():        db.create_all()    app.run(debug=True)`而不是`db.create_all() if __name__ == "__main__":    app.run(debug=True)`否则会出现报错：**RuntimeError: Working outside of application context.**

最终试运行网站的的数据库展示（密码已经过不可逆加密处理）![21cf0647d0b5c9a6a02513113e54f4e9](D:\Tencent Files\2993203761\nt_qq\nt_data\Pic\2025-05\Ori\21cf0647d0b5c9a6a02513113e54f4e9.png)

## characters.html

```html
!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>第五人格角色介绍</title>
    <style>
        body { background: #222; color: #eee; font-family: 'Crimson Text', serif; }
        .tab-box { margin: 30px 0 10px 0; }
        .tab { display: inline-block; margin-right: 20px; padding: 8px 20px; background: #444; color: #fff; border-radius: 5px; cursor: pointer; }
        .tab.active { background: #c5a46d; color: #222; }
        .role-list { display: flex; flex-wrap: wrap; gap: 20px; }
        .role-card { background: #333; border-radius: 8px; padding: 20px; width: 220px; box-shadow: 0 0 10px #0006; }
        .role-card img { width: 100%; border-radius: 6px; }
        .role-title { font-size: 1.2em; margin: 10px 0 5px 0; color: #c5a46d; }
        .role-desc { font-size: 0.95em; }
    </style>
</head>
<body>
    <h1>第五人格角色介绍</h1>
    <a href="/logout" style="color:#ffb200;float:right;">[退出登录]</a>
    <div class="tab-box">
        <span class="tab active" data-type="jgz">监管者</span>
        <span class="tab" data-type="qsz">求生者</span>
    </div>
    <div class="role-list" id="role-list"></div>
    <script>
    // roles数据由后端渲染
    var roles = {{ roles|tojson }};
    function renderRoles(type) {
        const list = document.getElementById('role-list');
        list.innerHTML = '';
        roles[type].forEach(role => {
            list.innerHTML += `
            <div class="role-card">
                <img src="${role.img}" alt="${role.name}">
                <div class="role-title">${role.name}</div>
                <div class="role-desc">${role.desc}</div>
            </div>`;
             });
    }
    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = function() {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            renderRoles(this.dataset.type);
        }
    });
    renderRoles('jgz');
    </script>
</body>
</html>
```

## content.html

```html

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欧利蒂丝庄园 - 第五人格</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'Gothic';
            src: url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');
        }

        @font-face {
            font-family: 'dwrg';
            src: url('{{ url_for('static', filename='images/汉仪第五人格体.ttf') }}') format('truetype');
        }

        body {
            background-color: #000;
            color: #e0d6c2;
            overflow-x: hidden;
            height: 100vh;
            position: relative;
            font-family: 'Times New Roman', serif;
        }

        /* 首页样式 */
        #home-page {
            width: 100%;
            height: 100vh;
            background-image: url('{{ url_for('static', filename='images/oletus.png') }}');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        #home-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        .intro-container {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 800px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #5a3e2b;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(90, 62, 43, 0.7);
            margin-bottom: 50px;
            animation: fadeIn 2s ease-in-out;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .intro-container::before, .intro-container::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            border: 2px solid #c9a568;
            border-radius: 50%;
            opacity: 0.5;
        }

        .intro-container::before {
            top: -10px;
            left: -10px;
            border-right: none;
            border-bottom: none;
        }

        .intro-container::after {
            bottom: -10px;
            right: -10px;
            border-left: none;
            border-top: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .intro-text {
            margin-bottom: 20px;
            text-align: left;
            text-shadow: 0 0 3px #000;
            letter-spacing: 0.5px;
            font-family: 'Times New Roman', serif;
        }

        .dialog-box {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #5a3e2b;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            animation: pulse 2s infinite;
            opacity: 0; /* 初始隐藏 */
            transition: opacity 1s ease;
        }

        .dialog-box.show {
            opacity: 1; /* 显示 */
        }

        .dialog-box:hover {
            background: rgba(20, 20, 20, 0.9);
            box-shadow: 0 0 15px rgba(201, 165, 104, 0.5);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(201, 165, 104, 0.3); }
            50% { box-shadow: 0 0 15px rgba(201, 165, 104, 0.7); }
            100% { box-shadow: 0 0 5px rgba(201, 165, 104, 0.3); }
        }

        .dialog-text {
            font-family: 'dwrg', sans-serif;
            font-size: 1.3rem;
            color: #c9a568;
            text-align: center;
            text-shadow: 0 0 3px #000;
            
        }

        /* 音乐开关图标 */
        .music-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: url('{{ url_for('static', filename='images/music-icon.png') }}') no-repeat center center;
            background-size: contain;
            cursor: pointer;
            z-index: 1000;
        }

        .music-toggle.playing {
            animation: rotate 2s infinite linear;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 角色页面样式 */
        #characters-page {
            display: none;
            width: 100%;
            min-height: 100vh;
            background: url('{{ url_for('static', filename='images/newpage.png') }}') no-repeat center center fixed;
            background-size: cover;
            padding: 50px 20px;
            position: relative;
        }

        #characters-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .characters-container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            font-family: 'dwrg', sans-serif;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #c9a568;
            text-shadow: 0 0 5px #000;
            letter-spacing: 2px;
        }

        .role-filter {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            background: rgba(90, 62, 43, 0.5);
            color: #e0d6c2;
            border: 1px solid #5a3e2b;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(201, 165, 104, 0.3);
            color: #c9a568;
            border-color: #c9a568;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            padding: 20px 0;
        }

        .character-card {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #5a3e2b;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            height: 350px;
        }

        .character-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border-color: #c9a568;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 60%, rgba(0, 0, 0, 0.9));
            z-index: 1;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            z-index: 2;
        }

        .character-name {
            font-family: 'dwrg', sans-serif;
            font-size: 1.5rem;
            color: #c9a568;
            margin-bottom: 10px;
            text-shadow: 0 0 3px #000;
        }

        .character-role {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(90, 62, 43, 0.7);
            border-radius: 3px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .survivor {
            background: rgba(0, 100, 0, 0.7);
        }

        .hunter {
            background: rgba(139, 0, 0, 0.7);
        }

        .character-desc {
            font-size: 0.9rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 返回按钮 */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 70px;
            padding: 10px 15px;
            background: rgba(90, 62, 43, 0.7);
            color: #e0d6c2;
            border: 1px solid #5a3e2b;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .back-btn:hover {
            background: rgba(201, 165, 104, 0.3);
            color: #c9a568;
            border-color: #c9a568;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .intro-container {
                width: 90%;
                padding: 20px;
            }

            .intro-text {
                font-size: 1rem;
            }

            .dialog-text {
                font-size: 1.1rem;
            }

            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
            }

            .character-card {
                height: 300px;
            }
            
            .back-btn {
                left: 60px;
                padding: 8px 12px;
            }
        }

        @media (max-width: 480px) {
            .cards-container {
                grid-template-columns: 1fr;
            }

            .role-filter {
                flex-wrap: wrap;
            }
            
            .music-toggle {
                width: 35px;
                height: 35px;
            }
            
            .back-btn {
                left: 50px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- 首页 -->
    <div id="home-page">
        <div class="intro-container">
            <p class="intro-text" id="intro-text-1"></p>
            <p class="intro-text" id="intro-text-2"></p>
        </div>
        <div class="dialog-box" id="enter-dialog">
            <p class="dialog-text">"你……真的决定要进去吗？"</p>
        </div>
    </div>

    <!-- 音乐开关图标 -->
    <div class="music-toggle playing" id="music-toggle"></div>

    <!-- 背景音乐 -->
    <audio id="background-music" loop>
        <source src="{{ url_for('static', filename='music/第五人格_爱给网_aigei_com.MP3') }}" type="audio/mpeg">
        您的浏览器不支持音频播放。
    </audio>

    <!-- 角色页面 -->
    <div id="characters-page">
        <button class="back-btn" id="back-btn">← 返回</button>
        <div class="characters-container">
            <h2 class="page-title">欧利蒂丝庄园角色档案</h2>
            <div class="role-filter">
                <button class="filter-btn active" data-role="all">全部</button>
                <button class="filter-btn" data-role="survivor">求生者</button>
                <button class="filter-btn" data-role="hunter">监管者</button>
            </div>
            <div class="cards-container" id="cards-container">
                <!-- 角色卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <script>
        const staticImageUrl = "{{ url_for('static', filename='images/') }}";
        // 角色数据
        const characters = [
            {
                id: 1,
                name: "园丁 - 艾玛·伍兹",
                role: "survivor",
                image: "园丁.png",
                description: "擅长园艺的年轻女孩，随身携带园艺剪刀。与稻草人先生有着不为人知的秘密关系。"
            },
            {
                id: 2,
                name: "医生 - 艾米丽·黛儿",
                role: "survivor",
                image: "医生.png",
                description: "拥有精湛医术的女医生，随身携带医疗针。在庄园中寻找失踪的病人。"
            },
            {
                id: 3,
                name: "律师 - 弗雷迪·莱利",
                role: "survivor",
                image: "莱利.png",
                description: "精明能干的律师，随身携带地图。为了调查一桩离奇案件而来到庄园。"
            },
            {
                id: 4,
                name: "佣兵 - 奈布·萨贝达",
                role: "survivor",
                image: "佣兵.png",
                description: "来自东方的雇佣兵，身手敏捷。为了完成最后的任务而进入庄园。"
            },
            {
                id: 5,
                name: "鹿头 - 班恩",
                role: "hunter",
                image: "鹿头.png",
                description: "戴着鹿头面具的监管者，使用钩链攻击求生者。曾是庄园的守林人。"
            },
            {
                id: 6,
                name: "摄影师 - 约瑟夫",
                role: "hunter",
                image: "约瑟夫.png",
                description: "约瑟夫·德拉索恩斯曾是当地受人尊敬的乡绅，富有、举止优雅并拥有迷人的异国口音。人们乐意为这位老绅士的个人爱好充当模特，但随着约瑟夫的摄影作品增加，村庄中的人却越来越少。看起来这位摄影师通过快门收集了一些容貌之外的东西。"
            },
            {
                id: 7,
                name: "红蝶 - 美智子",
                role: "hunter",
                image: "红蝶.png",
                description: "来自东方的舞者监管者，能够瞬间移动。因爱情悲剧而成为怨灵。"
            },
            {
                id: 8,
                name: "小丑 - 裘克",
                role: "hunter",
                image: "小丑.png",
                description: "疯狂的小丑监管者，使用火箭冲刺攻击。曾是马戏团的明星演员。"
            }
        ];

        // DOM元素
        const homePage = document.getElementById('home-page');
        const charactersPage = document.getElementById('characters-page');
        const enterDialog = document.getElementById('enter-dialog');
        const backBtn = document.getElementById('back-btn');
        const cardsContainer = document.getElementById('cards-container');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const introText1 = document.getElementById('intro-text-1');
        const introText2 = document.getElementById('intro-text-2');
        const musicToggle = document.getElementById('music-toggle');
        const backgroundMusic = document.getElementById('background-music');

        // 进入角色页面
        enterDialog.addEventListener('click', () => {
            homePage.style.display = 'none';
            charactersPage.style.display = 'block';
            renderCharacters('all');
        });

        // 返回首页
        backBtn.addEventListener('click', () => {
            charactersPage.style.display = 'none';
            homePage.style.display = 'flex';
        });

        // 角色筛选
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCharacters(btn.dataset.role);
            });
        });

        // 渲染角色卡片
        function renderCharacters(role) {
            cardsContainer.innerHTML = '';

            const filteredCharacters = role === 'all'
                ? characters
                : characters.filter(char => char.role === role);

            filteredCharacters.forEach(character => {
                const card = document.createElement('div');
                card.className = 'character-card';

                 card.innerHTML = `
                    <img src="${staticImageUrl}${character.image}" alt="${character.name}" class="card-image">
                    <div class="card-content">
                        <h3 class="character-name">${character.name}</h3>
                        <span class="character-role ${character.role}">
                            ${character.role === 'survivor' ? '求生者' : '监管者'}
                        </span>
                        <p class="character-desc">${character.description}</p>
                    </div>
                `;
                cardsContainer.appendChild(card);
            });
        }

        // 打字机效果
        function typeWriter(element, text, speed) {
            let i = 0;
            element.innerHTML = '';

            function typing() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typing, speed);
                } else {
                    // 文字输出完毕后检查是否需要显示按钮
                    checkAllTextTyped();
                }
            }

            typing();
        }

        // 检查所有文字是否已输出完毕
        function checkAllTextTyped() {
            const text1Complete = introText1.textContent.length === text1.length;
            const text2Complete = introText2.textContent.length === text2.length;

            if (text1Complete && text2Complete) {
                // 显示对话框按钮
                setTimeout(() => {
                    enterDialog.classList.add('show');
                }, 500); // 延迟500ms显示
            }
        }

        // 音乐控制逻辑
        function toggleMusic() {
            if (backgroundMusic.paused) {
                backgroundMusic.play().then(() => {
                    musicToggle.classList.add('playing');
                }).catch(error => {
                    console.log('播放失败:', error);
                });
            } else {
                backgroundMusic.pause();
                musicToggle.classList.remove('playing');
            }
        }

        // 初始化音乐播放
        function initMusic() {
            backgroundMusic.play().then(() => {
                musicToggle.classList.add('playing');
            }).catch(error => {
                console.log('自动播放被阻止:', error);
                // 如果自动播放失败，移除旋转动画
                musicToggle.classList.remove('playing');
            });
        }

        // 音乐图标点击事件
        musicToggle.addEventListener('click', toggleMusic);

        // 设置介绍文本
        const text1 = "在19世纪，欧洲某偏远山区有一个古老的庄园——欧利蒂丝庄园。这里流传着古怪的传言：从未露面的庄园主人多次举办神秘的\"寻宝游戏\"，然而，凡是参加游戏的人，均离奇失踪在庄园之中。这座庄园原本属于一个富有的家族，但随着一系列诡异事件的发生，庄园逐渐被世人遗忘。";
        const text2 = "10年前的一场大火吞噬了它，唯一的幸存者——侦探奥尔菲斯失去了记忆。如今，庄园的大门再次敞开，新的\"游戏\"即将开始……";

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化音乐
            initMusic();

            // 开始打字机效果
            setTimeout(() => typeWriter(introText1, text1, 80), 550);
            setTimeout(() => typeWriter(introText2, text2, 80), 550 + text1.length * 80 + 1000);
        });
    </script>
</body>
</html>
```

## login.html

```html
!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>第五人格 - 欧利蒂丝庄园</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Crimson+Text&display=swap');

        :root {
            --blood-red: #8b0000;
            --gothic-gold: #c5a46d;
            --aged-parchment: #e8e0cb;
            --deep-abyss: #0a0a0f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            background: var(--deep-abyss) url('{{ url_for("static", filename="images/identity.png") }}') no-repeat center/100% 100% fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Crimson Text', serif;
            position: relative;
            overflow: hidden;
        }

        input, textarea, [contenteditable] {
            user-select: auto;
            -webkit-user-select: auto;
                   }

        *:focus {
            outline: none;
        }

        .heraldry-container {
            background: rgba(255, 255, 255, 0.8);
            padding: 2.5rem;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
            width: 420px;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(197, 164, 109, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .heraldry-container:hover {
            border-color: rgba(197, 164, 109, 1);
            box-shadow: 0 0 15px rgba(197, 164, 109, 0.6);
        }

        .input-field {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(197, 164, 109, 0.8);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            color: #333;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding-left: 40px;
        }
         .input-field:focus {
            outline: none;
            border-color: rgba(197, 164, 109, 1);
            box-shadow: 0 0 15px rgba(197, 164, 109, 0.6);
            background: rgba(255, 255, 255, 0.8);
            animation: glow 1s infinite alternate;
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-112%);
            color: #333;
            font-size: 1.2rem;
        }

        .enter-btn {
            width: 100%;
            padding: 1rem;
            background: rgba(197, 164, 109, 0.8);
            border: none;
            border-radius: 4px;
            color: #333;
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .enter-btn:hover {
            background: rgba(197, 164, 109, 1);
        }
             .enter-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 48%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 52%
            );
            animation: buttonGlow 3s infinite;
        }

        .registration-call {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--gothic-gold);
            font-size: 0.5rem;
        }

        .registration-link {
            margin-top: 0.5rem;
            color: var(--blood-red);
            text-decoration: none;
            margin-left: 0.7rem;
            text-align: center;
            font-size: 0.82rem;
            transition: color 0.3s;
        }

        .logo-title {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 2.5rem;
            color: var(--gothic-gold);
            letter-spacing: 0.1em;
                        margin-bottom: 1rem;
            text-align: center;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 2rem;
            position: relative;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="heraldry-container">
        <div class="logo-section">
            <div class="logo-title">Oletus Manor</div>
        </div>

        <form id="loginForm">
            <div style="position: relative;">
                <input type="text" class="input-field" id="username" placeholder="侦探编号" required>
            </div>
            <div style="position: relative;">
                <input type="password" class="input-field" id="password" placeholder="庄园密匙" required>
            </div>
            <button type="submit" class="enter-btn">
                <span>进入庄园</span>
            </button>
        </form>

        <p class="registration-link">
            尚未获得庄园邀请？
            <a href="/register" class="registration-link">立即注册！</a>
        </p>
    </div>
     <script>
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch('/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = '/content';
                } else {
                    alert('登录失败：' + (data.message || '未知错误'));
                }
            });
        });
    </script>
</body>
</html>
```

## register.html

```html
!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>第五人格 - 欧利蒂丝庄园注册</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Crimson+Text&display=swap');

        :root {
            --blood-red: #8b0000;
            --gothic-gold: #c5a46d;
            --aged-parchment: #e8e0cb;
            --deep-abyss: #0a0a0f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            background: var(--deep-abyss) url('{{ url_for("static", filename="images/identity.png") }}') no-repeat center/100% 100% fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Crimson Text', serif;
            position: relative;
            overflow: hidden;
        }

        input, textarea, [contenteditable] {
            user-select: auto;
            -webkit-user-select: auto;
                   }

        *:focus {
            outline: none;
        }

        /* 维多利亚纹章容器 */
        .heraldry-container {
            background: rgba(255, 255, 255, 0.8);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
            width: 420px;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(197, 164, 109, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .heraldry-container:hover {
            border-color: rgba(197, 164, 109, 1);
            box-shadow: 0 0 15px rgba(197, 164, 109, 0.6);
        }

        /* 输入框样式 */
        .input-field {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1.2rem;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(197, 164, 109, 0.8);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            color: #333;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              padding-left: 40px;
        }

        .input-field:focus {
            outline: none;
            border-color: rgba(197, 164, 109, 1);
            box-shadow: 0 0 15px rgba(197, 164, 109, 0.6);
            background: rgba(255, 255, 255, 0.8);
            animation: glow 1s infinite alternate;
        }

        /* 输入图标 */
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-110%);
            color: #333;
            font-size: 1.2rem;
        }

        /* 注册按钮 */
        .register-btn {
            width: 100%;
            padding: 0.8rem;
            background: rgba(197, 164, 109, 0.8);
            border: none;
            border-radius: 4px;
            color: #333;
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.1em;
                       text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .register-btn:hover {
            background: rgba(197, 164, 109, 1);
        }

        .register-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 48%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 52%
            );
            animation: buttonGlow 3s infinite;
        }

        /* 已有账号提示 */
        .login-call {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--gothic-gold);
            font-size: 0.8rem;
        }

        .login-link {
            margin-top: 0.5rem;
            color: var(--blood-red);
            text-decoration: none;
            margin-left: 0.7rem;
                     text-align: center;
            font-size: 0.82rem;
            transition: color 0.3s;
        }

        /* 确保"Oletus Manor"的字体颜色不透明 */
        .logo-title {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 2.5rem;
            color: var(--gothic-gold);
            letter-spacing: 0.1em;
            margin-bottom: 0.7rem;
            text-align: center;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 1.5rem;
            position: relative;
            text-align: center;
        }

        .divider {
            width: 100%;
            height: 8px;
        }

        .error-message {
            color: var(--blood-red);
            font-size: 0.8rem;
            position: absolute;
            bottom: -0.5rem;
            width: 100%;
            text-align:left;
            visibility: hidden;
                      transition: visibility 0.3s;
        }

        .error-message.visible {
            visibility: visible;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(197, 164, 109, 0.6);
            }
            to {
                box-shadow: 0 0 15px rgba(197, 164, 109, 0.8);
            }
        }

        @keyframes buttonGlow {
            0% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.5;
            }
        }

        form {
            position: relative;
        }

        .form-group {
            position: relative;
            margin-bottom: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="heraldry-container">
        <div class="logo-section">
            <div class="logo-title">Oletus Manor</div>
        </div>
        <form id="registrationForm">
            <div class="form-group">
                <input type="text" id="username" class="input-field" placeholder="侦探编号" required>
                <div id="username-error" class="error-message"></div>
            </div>
            <div class="form-group">
                <input type="password" id="password" class="input-field" placeholder="设置庄园密匙" required>
                <div id="password-error" class="error-message"></div>
            </div>
            <div class="form-group">
                <input type="password" id="confirm-password" class="input-field" placeholder="确认庄园密匙" required>
                <div id="confirm-password-error" class="error-message"></div>
            </div>
            <button type="submit" class="register-btn">
                <span>注册庄园</span>
            </button>
        </form>
        <p class="login-link">
            已有庄园账号？
            <a href="/login" class="login-link">立即登录！</a>
        </p>
    </div>
    <script>
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            let hasError = false;
            // 基本校验
            if (username.length < 4) {
                alert('侦探账号至少需要4个字符');
                hasError = true;
                    }
            if (password.length < 6) {
                alert('庄园密匙至少需要6个字符');
                hasError = true;
            } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+/.test(password)) {
                alert('庄园密匙必须包含大小写字母和数字');
                hasError = true;
            }
            if (password !== confirmPassword) {
                alert('两次输入的庄园密匙不一致');
                hasError = true;
            }
            if (!hasError) {
                fetch('/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: username, password: password})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                        window.location.href = '/login';
                    } else {
                        alert(data.error);
                    }
                });
            }
        });
    </script>
</body>
</html>
```

## index.html

```html
!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>我的主页</title>
</head>
<body>
    <h1>欢迎访问我的网站！</h1>
    <p>这是主页内容。</p>
</body>
</html>

```



# 三、代码优化事项：

## （一）为确保能够正常实现登录注册跳转等功能需要把这些HTML嵌入Flask实现的登录和注册功能里。

### 1. 放置你的 HTML 文件

将你的HTML代码分别保存为如下格式：

- `templates/login.html`（登录页）
- `templates/register.html`（注册页）

------

#### `templates/login.html`

> 直接粘贴你现有的登录HTML代码即可。你可以保留JS中fetch的action（如`/login`）。

#### `templates/register.html`

> 直接粘贴你现有的注册HTML代码即可。注意fetch action应为`/register`（建议统一json或表单格式，见下）。

------

### 2. Flask 后端处理

在`app.py`加入如下代码（参考前面我的回答，并做如下适配）：

```python
from flask import Flask, render_template, request, jsonify, session, redirect, url_for
from flask_sqlalchemy import SQLAlchemy
from werkzeug.security import generate_password_hash, check_password_hash

app = Flask(__name__)
app.secret_key = 'key'
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///idv.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
db = SQLAlchemy(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    password_hash = db.Column(db.String(200), nullable=False)

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)

@app.route('/login', methods=['GET'])
def login_page():
    return render_template('login.html')

@app.route('/login', methods=['POST'])
def login_api():
    # 如果你的前端post用content-type=x-www-form-urlencoded
    username = request.form.get('username')
    password = request.form.get('password')
    if not username or not password:
        return jsonify(success=False, message="用户名或密码不能为空")
    user = User.query.filter_by(username=username).first()
    if user and user.check_password(password):
        session['user_id'] = user.id
        return jsonify(success=True, message="登录成功")
    else:
        return jsonify(success=False, message="账号或密码错误")

@app.route('/register', methods=['GET'])
def register_page():
    return render_template('register.html')

@app.route('/register', methods=['POST'])
def register_api():
    data = {}
    # 前端为json格式注册
    if request.is_json:
        data = request.get_json()
        username = data.get('username')
        password = data.get('password')
    else:
        username = request.form.get('username')
        password = request.form.get('password')

    if not username or not password:
        return jsonify(error="用户名和密码不能为空")
    if User.query.filter_by(username=username).first():
        return jsonify(error="用户已存在")
    user = User(username=username)
    user.set_password(password)
    db.session.add(user)
    db.session.commit()
    return jsonify(message="注册成功！")

@app.route('/content')
def content():
    # 这里可以判断session来决定是否通过
    if 'user_id' not in session:
        return redirect(url_for('login_page'))
    # 这里可以渲染你的第五人格角色介绍页面（比如content.html）
    return "第五人格角色介绍页（开发中）"

if __name__ == '__main__':
    db.create_all()
    app.run(host="0.0.0.0", port=5000, debug=True)
```

------

### 3. 衔接说明

- **login.html**
  JS里的fetch提交给 `/login`，类型 `application/x-www-form-urlencoded`，Flask后端用`request.form`获取参数，返回json，前端根据`success`字段决定跳转或显示错误。
- **register.html**
  JS里的fetch提交至 `/register`，类型`application/json`，Flask后端用`request.get_json()`取参数，处理注册逻辑，返回json，JS弹窗是否注册成功。

------

### 4. 进入/跳转逻辑

- 登录后用：

  ```
  window.location.href = '/content';
  ```

- 注册成功可以直接跳回登录页：

  ```
  window.location.href = '/login';
  ```

## （二）音乐图片文字正常显示

### 1.创建存放目录static

### 2.HTML代码修改：

| 功能   | 写法举例                                                     |
| ------ | ------------------------------------------------------------ |
| 图片   | `{{ url_for('static', filename='images/xxx.png') }}`         |
| 音乐   | `{{ url_for('static', filename='music/xxx.mp3') }}`          |
| 字体   | `{{ url_for('static', filename='images/xxx.ttf') }}`         |
| JS变量 | `<script>const staticImageUrl = "{{ url_for('static', filename='images/') }}";</script>` |
| JS图片 | `<img src="${staticImageUrl}${character.image}">`            |

| 用途           | 原写法                              | 推荐写法(url_for)                                            |
| -------------- | ----------------------------------- | ------------------------------------------------------------ |
| 字体           | src: url(汉仪第五人格体.ttf)        | src: url(“{{ url_for(‘static’, filename=‘images/汉仪第五人格体.ttf’) }}”) |
| 背景图         | background-image: url(‘oletus.png’) | background-image: url(“{{ url_for(‘static’, filename=‘images/oletus.png’) }}”) |
| 音乐icon       | background: url(‘music-icon.png’)   | background: url(“{{ url_for(‘static’, filename=‘images/music-icon.png’) }}”) |
| 角色背景       | background: url(newpage.png)        | background: url(“{{ url_for(‘static’, filename=‘images/newpage.png’) }}”) |
| 音频           | <source src=“xxx”>                  | <source src=“{{ url_for(‘static’, filename=‘music/xxx.mp3’) }}”> |
| 卡片图片src JS | <img src=“园丁.png”>                | <img src=“𝑠𝑡𝑎𝑡𝑖𝑐𝐼𝑚𝑎𝑔𝑒𝑈𝑟𝑙staticImageUrl{character.image}”>    |

### 如若出现部分图片无法加载的情况，请注意按照以下步骤：

#### 1.**定义 staticImageUrl**

在你所有 JS 之前加上这句，用 Jinja2 渲染路径前缀，保证任何部署路径都正确：

```html
<script>
const staticImageUrl = "{{ url_for('static', filename='images/') }}";
...
</script>
```

#### 2. **确认图片资源实际存在于 static/images 目录下，拼写无误**

#### 3. **保持 image 字段仅为文件名，不带路径**

例子如下：

```html
image: "园丁.png" 
// 不要写成 static/images/园丁.png 或 /images/园丁.png
```

#### 4. **刷新浏览器缓存（Ctrl+F5），防止缓存导致的假错误**



# 四、网页环境配置方法

## 1.确认虚拟机网络配置（一般使用桥接模式）

1. 关闭虚拟机。
2. 在VMware中，进入虚拟机的设置 -> 网络适配器 -> 选择“桥接模式(Bridged)”。
3. 启动虚拟机，确认虚拟机获取到了和宿主机相同子网的IP地址。

## 2.获取虚拟机ip地址

1.执行`ip a`或者`ifconfig`，确认虚拟机与宿主机在同一子网如宿主机IP为 `192.168.1.100`，虚拟机应为 `192.168.1.x`（这里我的虚拟机的ip地址为**10.21.78.179**

2.若IP不在同一网段：

检查路由器是否分配了IP（桥接模式下虚拟机应直接通过路由器获取IP）。

![img](https://img.chatgot.io/user-chat/67f51a99400fa1aa0350dba6/J6NprmH7kfM9-kIRbUskkN9XO-1745723625763)

## 3. 配置网站服务器监听所有IP地址

确保你搭建的网站服务监听的是所有IP地址（`0.0.0.0`），而不仅仅是`127.0.0.1`。
例如，Apache/nginx默认一般是监听0.0.0.0，某些开发环境的服务器需要改配置。

(这一部分是在app.py中的flask板块完成的)

## 4. 关闭或允许Kali防火墙放行服务端口

Kali Linux默认防火墙一般是`ufw`或者没有启用，但你需要确认防火墙允许80（HTTP）或者443（HTTPS）端口开放。
如果用`ufw`，可以执行：

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable   # 如果防火墙没启动的话
```

尝试重启网络服务：

```bash
sudo systemctl restart networking
```

## 5. 测试外部访问

- 从宿主机浏览器访问虚拟机IP`http://192.168.1.100`。正常打开说明配置成功。
- 从同一局域网中其他设备访问 `http://192.168.1.100`。

（我的网页网址为http://10.21.78.179/)

运行程序，打开网页

```bash
cd ~/idv_site
python3 app.py
```



# 五、后续问题：

### 此时在外部宿主机浏览器上输入网址，跳出来的却不是登录界面![img](https://img.chatgot.io/user-chat/67f51a99400fa1aa0350dba6/6RjCjRojDXsj-Xi1u9b5KVy99-1745723713219)

这是Apache2 在 Debian（或者基于 Debian 的 Kali）系统上的默认欢迎页面，这说明了以下问题：

- 你在虚拟机中安装了 Apache2 网络服务器，服务器运行正常。
- 你通过浏览器访问了虚拟机的 IP 地址（从截图中看到是 `10.21.78.179`）。
- 由于你还没有替换默认的网页文件（通常是 `/var/www/html/index.html`），所以访问时显示的是 Apache2 默认页面。
- 页面中详细说明了 Apache2 在 Debian 系统上的配置文件和目录结构，提示你可以替换 `/var/www/html` 下的内容来定制自己的网站。

#### 因此，需要替换默认网页文件：

你已经有自己的网页文件夹 `~/idv_site`，想用它替换 Apache2 默认的网页内容，步骤如下：

##### 1. 确认已有网页文件目录
假设你的文件夹路径是 `/home/your_username/idv_site`，可以用命令查看：  
```bash
ls ~/idv_site
```

##### 2. 备份默认网页文件（建议）
Apache2 默认网页位于 `/var/www/html`，可以先备份：  
```bash
sudo mv /var/www/html /var/www/html_backup
```

##### 3. 将你的网页文件复制到 Apache 目录
把 `idv_site` 目录内容复制到 `/var/www/html`：

直接用 rsync（推荐，保留权限）  
```bash
sudo rsync -avh ~/idv_site/ /var/www/html/
```

##### 4.设置文件权限

确保 Apache 用户（通常是 `www-data`）能读取这些文件：

```bash
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html
```

##### 5. 重启 Apache 服务
使更改生效：

```bash
sudo systemctl restart apache2
```

---

##### 6. 访问确认
用浏览器访问你的虚拟机 IP 地址，比如：  
```
http://10.21.78.179
```
这时应该显示你的 `idv_site` 中的网页内容。





### 接下来，更近一步，可是出现了这种问题，得到的是目录列表界面：![img](https://img.chatgot.io/user-chat/67f51a99400fa1aa0350dba6/JbN0ks1CCHf4-JIWYtlf7GwdC-1745724675177)

这个界面是 Apache 服务器在目录没有默认首页文件（如 index.html）时，自动生成的目录列表页面，这说明了：

- 你在虚拟机中安装了 Apache2 网络服务器，服务器运行正常。
- 你通过浏览器访问了虚拟机的 IP 地址（从截图中看到是 `10.21.78.179`）。
- 由于你还没有替换默认的网页文件（通常是 `/var/www/html/index.html`），所以访问时显示的是 Apache2 默认页面。
- 页面中详细说明了 Apache2 在 Debian 系统上的配置文件和目录结构，提示你可以替换 `/var/www/html` 下的内容来定制自己的网站。

#### 你需要把自己的网页文件放在 `/var/www/html/` 并确保有默认首页文件，重启 Apache 后访问时才能看到你设计的网页：

##### 1.在文件夹内创建一个index.html文件（在前面的核心代码块中，不作重复展示）

##### 2.把文件和其它网页一起复制到 Apache 根目录：

```bash
sudo rsync -avh ~/idv_site/ /var/www/html/
```

##### 3.重启 Apache：

```bash
sudo systemctl restart apache2
```

##### 4.在浏览器访问你的 IP，应该就会显示这个主页了。



### 更近一步，我们需要首先看到的是登录界面，而并非index.html，因此我们需要修改 Apache 默认首页顺序，优先加载 `login.html`:

##### 1.打开 Apache 的默认首页配置文件：

```
sudo nano /etc/apache2/mods-enabled/dir.conf
```

##### 2.找到类似下面的行：

```
DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm
```

将 `login.html` 放到最前面，改为：

```bash
DirectoryIndex login.html index.html index.cgi index.pl index.php index.xhtml index.htm
```

##### 3.保存并退出编辑器（Ctrl+O，回车，Ctrl+X）。

##### 4.重启 Apache 服务：

```
sudo systemctl restart apache2
```

这样，当用户访问你的服务器 IP 或根路径时，会自动加载 `login.html`。





### 但是，进一步我们会发现，首先进入登录界面后，如果想跳转到注册界面是不成功的：![img](https://img.chatgot.io/user-chat/67f51a99400fa1aa0350dba6/RdI4BovYGszn-zsV896ET0fzC-1745726217833)

这是因为：

- 你的 Flask 应用监听的是5000端口（`app.run(port=5000)`）。
- Apache 默认监听80端口，且没有配置反向代理。
- 当你访问 `http://服务器IP/register`，请求其实落在了 Apache 的80端口上，Apache默认是找 `/var/www/html/register` 目录或文件，没有找到对应的 `register`，所以返回了404。
- Flask应用里有`/register`路由，但 Apache没有将请求转发给 Flask，所以 Flask 路由没被调用。

#### 配置 Apache 反向代理到 Flask 应用端口（推荐生产环境做法）

##### 步骤1：登录服务器，执行以下命令启用 Apache 反向代理模块

```
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo systemctl restart apache2
```

------

##### 步骤 2：配置 Apache 虚拟主机

1.新建配置文件（以 `flask_app.conf` 为例），使用你喜欢的编辑器，例如 `nano`：

```
sudo nano /etc/apache2/sites-available/flask_app.conf
```

2.把下面内容复制进去（请确保 `ServerName` 写为你的服务器IP `10.21.78.179`）：

```
<VirtualHost *:80>
    ServerName 10.21.78.179

    ProxyPreserveHost On

    ProxyPass / http://127.0.0.1:5000/
    ProxyPassReverse / http://127.0.0.1:5000/

    # 如果你有静态文件路径，可以解除注释并配置
    # ProxyPass /static !
    # Alias /static /path/to/static/
    # <Directory /path/to/static/>
    #     Require all granted
    # </Directory>
</VirtualHost>
```

3.保存并退出 (`Ctrl+O`，回车，`Ctrl+X`)

------

##### 步骤 3：启用新站点并重载 Apache 配置

```
sudo a2ensite flask_app.conf
sudo systemctl reload apache2
```

------

##### 步骤 4：启动你的 Flask 应用（假设你的 app.py 位于用户主目录）

```
cd ~/你的flask项目目录
python3 app.py
```

确保控制台没有报错，Flask 应用监听在 `0.0.0.0:5000`。

------

##### 步骤 5：访问你的服务

在浏览器中打开：

```
http://10.21.78.179/register
```

应该能正常访问你写的 Flask 注册页面。